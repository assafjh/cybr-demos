---
# Load policy into kubernetes branch
# This policy defines the demo branch kubernetes

- !policy
  id: followers
  owner: !group managers

# followers/jwt is a layer that will aggregate permissions for all kubernetes followers that want to use JWT
- !layer
  id: followers/jwt
  owner: !group managers

# Create the JWT identity that we will use to authenticate to Conjur 
- !host
  id: followers/system:serviceaccount:conjur-follower-jwt:conjur-demo-acct
  owner: !group managers
  annotations:
    authn-jwt/k8s-follower1/kubernetes.io/namespace: conjur-follower-jwt
    authn-jwt/k8s-follower1/kubernetes.io/serviceaccount/name: conjur-demo-acct

# Add the host we have created to the layer 
- !grant
  roles:
    - !layer followers/jwt
  members:
    - !host followers/system:serviceaccount:conjur-follower-jwt:conjur-demo-acct

